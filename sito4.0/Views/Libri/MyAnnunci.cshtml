@model Annunci.Libri.Models.SearchLibri
@{
    ViewBag.Title = "Trova libro: I miei annunci";
    ViewBag.Description = "Con Trova-libro puoi vendere e comprare libri usati e testi universitari. Il servizio è gratuito e senza costi di intermediazione";
    ViewBag.Keywords = "libro usato, libri usati, libro, usati, usato, università, universitari, compro libri usati, vendo libri usati, cerco libri usati, scambio, annunci, vendo libri, cerco libri, compro vendo libri, vendo libri ";

    Layout = "~/Views/Shared/_MasterPageMobile.cshtml";
    WebGrid wGrid = new WebGrid(null, rowsPerPage: Model.PageSize, defaultSort: Model.Sort, canPage: false);
    wGrid.Bind(Model.Libri, rowCount: Model.TotalRows, autoSortAndPage: false);
}

<div class="mt-3"></div>
<a class="btn btn-secondary float-right" href="@Url.Action("Create" )" role="button">Nuovo annuncio<i class="fa fa-plus fa-fw"></i></a>
<h2>I miei annunci</h2>
<p>In questa pagina sono elencati gli annunci che hai pubblicato.</p>
 <p>Per ogni annuncio è indicato il <b>numero di risposte</b> che hai ricevuto.</p>
<p>Clicca sul dettaglio dell'annuncio per vedere le trattative in corso con le relative risposte.</p>
<p>   Se desideri aggiungere altre immagini oppure modificare il testo del messaggio clicca su  <i class="fa fa-info"></i>  per aprire il dettaglio dell'annuncio</p>


<form action="@Url.Action("MyAnnunci")" method="post" id="MyForm">

    <p class="lead">Filtri</p>
    <div class="row">
        <div class="col-md-4">
            <div class="form-group">
                <label for="titolo">Titolo</label>
                <input type="text" class="form-control" name="filter.titolo" value="@Model.filter.titolo">
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label for="titolo">Autore</label>
                <input type="text" class="form-control" name="filter.autore" value="@Model.filter.autore">
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label for="isbn">ISBN</label>
                <input type="text" class="form-control" name="filter.isbn" value="@Model.filter.isbn">
            </div>
        </div>
    </div>

    <button type="reset" class="btn btn-default">Reset</button>
    <button type="submit" class="btn btn-primary">Ricerca<i class="fa fa-search fa-fw"></i></button>



    @if (Model.TotalRows == 0)
    {
        <h3>Non è stato trovato nessun libro.</h3>
    }
    else
    {
        <div style="margin-top: 20px;">
            @wGrid.GetHtml(
         fillEmptyRows: false,
         tableStyle: MyConstants.TABLE_STYLE,
         headerStyle: MyConstants.TABLE_HEADER_STYLE,
         footerStyle: MyConstants.TABLE_FOOTER_STYLE,
         rowStyle: MyConstants.TABLE_ROW_STYLE,
         alternatingRowStyle: MyConstants.TABLE_ALTERNATING_ROW_STYLE,
         htmlAttributes: new { data_role = "table", id = "MyWebGrid", data_mode = "reflow" },
         columns: new[]{
              wGrid.Column ("", header :"",
                        format:@<text>
            @if (((long)(ViewData["hashtableRisposte"] as System.Collections.Hashtable)[item.annuncioId]) > 0)
                    {
                <img src="@Url.Content("~/Content/Images/shared/green2_16x16.png")" alt="Ci sono delle risposte per l'annuncio" />
                    }
                    else
                    {
                <img src="@Url.Content("~/Content/Images/shared/empty.gif")" alt="Non ci sono risposte per l'annuncio" />
                    }
            </text>
                        , canSort : false)   ,
                wGrid.Column (columnName:"categoria", header :"Categoria", canSort : true),
                wGrid.Column (columnName:"dataInserimento", header :"Data",  format: p=>p.DataInserimento.ToShortDateString() ,canSort : true),
                wGrid.Column (columnName:"tipo", header :"Tipo", canSort : true),
                wGrid.Column (columnName:"titolo", header :"Titolo", format:(item) =>  Html.ActionLink ( (string) (string.IsNullOrEmpty (item.titolo)?"N/A":item.titolo.ToString()), "MyAnnuncio",   new {id=item.annuncioId} ), canSort:true),
                wGrid.Column (columnName:"prezzo", header :"Prezzo", canSort : true),
                wGrid.Column ("", header :"Risposte",    format: item=> (ViewData["hashtableRisposte"] as System.Collections.Hashtable)[item.annuncioId],  canSort : false),
                wGrid.Column ("", header :"Dettagli",
                        format:@<text><a title="Detagli" href="@Url.Action("MyAnnuncio", "Libri", new { id = item.annuncioId })"><i class="fa fa-info"></i></a></text>
                        , canSort : false)   ,
                wGrid.Column ("", header :"Cancella",
                        format:@<text><a title="Cancella" href="javascript:deleteRow('@item.annuncioId');"><i class="fa fa-trash"></i></a></text>
                        , canSort : false)
                })

            @{Html.RenderPartial("_Paging", Model);}
        </div>
     }
</form>




@using (Html.BeginForm("Delete", "Libri", FormMethod.Post, new { id = "MyFormDelete" }))
{
    @Html.AntiForgeryToken()
    <input type="hidden" id="annuncioId" name="annuncioId" />
}


<script type="text/javascript">
    function deleteRow(id) {
        // alert("deleteRow: " + id);



        //<td><a href="javascript:deleteRow('i.immobileId');" data-role="button" data-iconpos="notext" data-inline="true" data-theme="b" data-icon="delete">Delete</a></td>


        //$("#popupDialogConfirm").dialog({
        //    resizable: false,
        //    height: 140,
        //    modal: true,
        //    buttons: {
        //        "Delete selected toon": function () {
        //            alert("ff");
        //           // $(this).dialog("close");
        //        },
        //        Cancel: function () {
        //            $(this).dialog("close");
        //        }
        //    }
        //});
        //$.mobile.changePage("#myDialog");
        //if (window.confirm("Confermare l'operazione")) {
        $("#annuncioId").val(id);
        $("#MyFormDelete").submit();
        //}

    }
</script>
